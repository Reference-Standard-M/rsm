:source-highlighter: highlight.js
:highlightjs-languages: bash

[role="left"]
image:https://www.fourthwatchsoftware.com/images/fws-logo-horizontal.png[caption
="Fourth Watch Software Logo", width="480", height="80"]

[role="right"]
link:doc/index.adoc[Index]

'''

== Reference Standard M Changelog

=== v1.77.0 -- 2023 Jan 5

* Add restricted mode, `-R`, which prevents jobs from shelling out [`$&%SPAWN`]
* Add current volume to the direct mode prompt
* Add partial (UCI) support for standard extended references using vertical bars
* Add error count to routine syntax check
* Add support for setting `M` and `Z` errors to `$ECODE`
* Add `CHARACTER` node to the `^$SYSTEM` system variable
* Add systemd user template service file [`rsm@.service`]
* Add systemd environment configuration file [`rsm.env`]
* Add Bash completion script for RSM [`rsm`]
* Prepare for multi-volume support
  - Move daemon logs to `log` directory
  - Add volume numbers to daemon log names
  - Add volume support to last block used
  - Update database file mounting code
  - Update volume mount support
  - Add volume dismount support
  - Add volume support to environment start
  - Add volume support to routine buffers
  - Add volume support to journal shutdown
  - Add volume support to daemon shutdown queue sync
  - Add volume support to `$&DEBUG("RBD")`
  - Add volume support to M vendor utilities
* Change the defaults of the historic language features from off to on
  - `^$SYSTEM("$NEXTOK")` - support for `$NEXT`
  - `^$SYSTEM("EOK")` - support for scientific exponent notation with `E`
  - `^$SYSTEM("OFFOK")` - support for tag/label line offsets with `+`
* Expose semaphore array ID and shared memory IDs to the system information menu
* Add missing database block statistics counters
* Add missing database block counters to the system statistics utility [`^%STA`]
* Lower minimum block size from 4 KiB to 1 KiB
* Increase size of lock table from 8 KiB to 16 KiB per job
* Increase minimum number of global buffer descriptors from 40 to 64
* Change routine reserve time from 17 to 20 minutes
* Improve database block allocation and map block algorithms
* Make daemon shutdown cache syncing more robust
* Fix offset bug with entry references with formal but no actual parameters
* Fix entry reference and extrinsic offset bugs
  - Issue https://gitlab.com/Reference-Standard-M/rsm/-/issues/2
* Fix extrinsic addition expression bug that erroneously compiles as an offset
* Fix bug preventing job indirection with timeouts
* Fix bug when setting an error code with only an ending comma in `$ECODE`
* Fix bug when using an empty indirection string as the argument to `$TEXT`
* Fix `$QSUBSCRIPT` bug which returns environment names in the wrong order
* Fix lock table descriptor debugging output [`$&DEBUG("LTD")`]
* Simplify and improve the Make configurations
* Rename the Make configuration files
  - `Makefile` => `GNUmakefile`
  - `BSDmakefile` => `Makefile`
* Rename directory `conf` => `etc`
* Improve and update the Docker configuration file [`Dockerfile`]
* Improve the `docker` and `upgrade` shell scripts
* Improve the `magic` configuration file
* Improve history recall functionality to avoid duplicating history
* Improve I/O handling errors when using `$&%FORK`
* Add improved error handling in various places
* Improve error messages in various places
* Fix duplicate startup messages in Docker container by flushing standard out
* Fix issue in Docker container with daemon shutdown, caused by SIGINT signals
* Fix global compression bug caused by deadlock
* Fix sequential I/O bug when not running in a TTY
* Fix decimal point bug when adding decimal numbers that equal 0 in math module
* Fix divide-by-zero bug when numerator is also 0 in math module
* Fix compiler error buffer bug
* Fix several bugs in the interactive debugger
* Fix various minor bugs and inefficiencies
* Improve data typing in multiple places, including tighter scoping
* Fix segfaults in system variable nodes
* Replace some deprecated C library calls
* Update versioning macros and functions to support pre-release versions of RSM
* Rework and/or add some of the warning and version macros
* Update continuous integration configuration script [`.gitlab-ci.yml`]
* Fix namespace bug in `OPEN` command
* Set missing map dirty flag when creating a new UCI
* Add volume error checks to the view buffers
* Set missing global volume number when releasing a view buffer
* Change SIGTSTP, SIGCONT, SIGTTIN, SIGTTOU process signals to default behavior
* Increase incoming socket pending connection queue from 3 to 5
* Improve escape processing in more contexts
* Fix memory leaks in `$FNUMBER`
* Add support for PNG files to the RSM web server
* Add total count to the routine compile check in the MCL
* Add status of the `QUIT` breakpoint code to the `^%SHOWBP` vendor utility
* Improve error handling in multiple M vendor utilities
* Improve variable scoping in multiple M vendor utilities
* Fix bug in block dump to global in the block dump utility [`^%BLKDMP`]
* Fix error handling bugs in MCL, including stack and history bugs
* Fix display bug in system statistics vendor utility [`^%STA`]
* Improve execution of shell commands in the MCL
* Reformat some of the M code in `utils.rsm`

This version made a change to the MCL source that requires the M vendor
utilities to be reloaded via the bootstrap method, e.g.,

[source,bash]
----
rsm -x 'open 1:("utils.rsm":"read") use 1 read code xecute code'
----

=== v1.76.2 -- 2022 Feb 23

* Improve escape processing while editing M input [`READ`]
* Fix `PRECISION` node in `^$JOB` so jobs can set their own decimal precision
* Fix incorrect permissions on the UCI and volume configuration nodes in `^$JOB`
* Fix bug that causes jobs to hang when setting UCI to a non-existent one
* Change constants in the math library [`^MATH`] to support decimal precision
* Reformat some of the M code in `utils.rsm`
* Fix some minor bugs in `utils.rsm`
* Lower max volumes to 1 until additional volumes are fully supported

=== v1.76.1 -- 2022 Feb 8

* Improve multi-line input editing on slow terminal displays
* Fix bug with multi-line buffers on the last line of the terminal display
* Change journal permissions on creation to 660 to allow group member usage
* Add more information to the conformance clause
* Fix mistakes in the language guide
* Improve the format of various error messages

=== v1.76.0 -- 2022 Feb 1

* Add `$INCREMENT` intrinsic function
* Add `^$CHARACTER` system variable
* Add `^$DEVICE` system variable
* Add Dockerfile to create a simple RSM Docker container image
* Add daemon PID information to the system information menu
* Add new vendor utility for forward journal recovery [`^JOURNREC`]
* Add multi-line input editing capability to the direct and debug modes
* Improve multi-line editing in the MCL vendor utility routine [`^%M`]
* Add support for read-write operations (`IO`) on files to the `OPEN` command
* Improve translation table syntax to allow globals without extended references
* Reformat the M code in `utils.rsm`
* Add `BIG_ENDIAN` node to the `^$SYSTEM` system variable
* Add `COLLATE` node to the `^$GLOBAL` system variable
* Add `docker` script to run RSM in the RSM Docker container
* Modify vendor utility function `BIGEND^%U` to use `^$SYSTEM("BIG_ENDIAN")`
* Fix `$QSUBSCRIPT` bug which returns global names without the caret [`^`]
* Fix bug in the integrity checker loop test that prevents full checks
* Improve overflow and underflow checks in string to int conversion function
* Improve the formatting of the `$&DEBUG("RBD")` and `$&DEBUG("LTD")` XCalls
* Fix error trap bugs in the global extended lister vendor routine [`^%G`]
* Fix bug in the error trap of the integrity checker vendor routine [`^IC`]
* Fix 12 hour mode in the time display vendor routine [`^%T`]
* Add 24 hour mode option to the time display vendor routine [`^%T`]
* Fix bug in UCI editor vendor routine [`^UCI`], preventing proper editing
* Add documentation for the new instrinsic function and the new system variables
* Add missing documentation to the language guide
* Fix mistake in the documentation for `BREAK` in the language guide
* Fix description of standard compliance for `SET` in the language guide
* Change `make test` to `make debug`
* Move asserts to debug build
* Remove redundant vendor routine [`^MUMTRIS2`] -- already have `^MUMTRIS`

=== v1.75.1 -- 2021 Nov 23

* Fix false positive DBC overflow bug in the integrity checker
* Revert fix of argument encoding from previous release
* Fix tag/label offset bug with offsets of 2
* Improve the formatting of the `$&DEBUG("RBD")` XCall
* Improve the platform support section of the documentation
* Add a helpful note about recompiling routines to the documentation
* Make various small improvements to source code formatting

This version reverts the previous version's change to the bytecode format. If
you compiled any routines on the previous version you might need to recompile
them.

=== v1.75.0 -- 2021 Nov 12

* Add use of all ASCII characters [0-127] as input terminators
* Add `-V` option to the `rsm` executable, to return the short version string
* Add `-i` option to the `rsm` executable, to return the system information menu
* Improve the `-k` option to the `rsm` executable, making it native and robust
* Increase max I/O channels from 32 to 64
* Restructure the help menu and add the new `-V` and `-i` options to it
* Move the database/compiler version info from the help menu to the info menu
* Add `uninstall` rule to the build files
* Add `path=` option to the `install` and `uninstall` rules in the build files
* Finish support for big-endian architectures
* Add new error [`Z49`] for when the job table is full while trying to fork
* Improve documentation, including the first draft of the language guide
* Add the initial conformance guide to the documentation
* Add new license file for the documentation license
* Reformat all source files that haven't already been reformatted
* Rename most of the source files and restructure init utilities
* Fix argument encoding to work with full argument limits
* Improve error handling of tag/label offsets that are too large
* Fix bug in debugger that prevents proper reset in certain scenarios
* Add current volume to the M Command Language (MCL) prompt
* Improve output of shell commands in pipe/shell modes of the `^$&%SPAWN` XCall
* Remove terminal hacks in `utils.rsm` that are no longer necessary
* Change database permissions on creation to 640 for better security
* Improve fix to double free bug preventing a possible leak during error frames
* Fix bug that prevents display of some error messages when starting a job
* Fix non-existent volume bug that leads to a segfault
* Fix bug with `T` option not adding a trailing space in `$FNUMBER`
* Fix the semantics of timeouts of 0 with the `OPEN` and `READ` commands
* Fix bug that mangles arguments to the `JOB` command when run via `rsm -x`
* Fix bug in the inline function that tests for empty names (`VAR_U`)
* Fix bug that left an open database file descriptor when starting the daemons
* Fix bug that opens the database file a second time during a `JOB` command
* Fix bug in the `$&PASCHK` XCall that closes the password file prematurely
* Fix issues with some XCalls on MacOS X
* Improve, and fix, some of the M language error messages
* Rework some of the error macros
* Add compiler warning suppression macros for array bounds false positives
* Optimize part of the sequential I/O initialization
* Add new vendor utility routine to show current breakpoints [`^%SHOWBP`]
* Fix bug in the big-endian M vendor utility routine entryref [`$$BIGEND^%U`]
* Fix bug in vendor global extended lister utility routine [`^%G`]
* Fix display bug in vendor routine directory utility routine [`^%RD`]
* Improve output of the block dumping vendor utility routine [`^%BLKDMP`]
* Improve the screen handling of the MCL vendor utility routine [`^%M`]
* Fix variable scoping in the MCL vendor utility routine [`^%M`]
* Improve the help menu output in the MCL vendor utility routine [`^%M`]
* Fix undefined bug in the MCL error trap vendor utility [`^%ET`]
* Remove redundant vendor routine [`^LOG2`] -- already in `^MATH3`
* Make many improvements to the vendor-supplied M web server [`^%WWW` `^%WWW1`]
* Remove support routines for the '`ONE`' application [`^%LCSEND` `^%LCSRV*`]
* Improve user interface handling in some vendor-supplied utility routines
* Improve support for newer versions of GCC and Clang (>= GCC 11)
* Add support for AIX to the source and build files
* Make several improvements to the build files to make them more robust

This version made a slight change to the bytecode format, but the compiler
version was not updated. As a consequence you might need to recompile your
routines.

=== v1.74.0 -- 2021 Jul 28

* Increase max string length from 32767 characters to 65534 characters
* Increase max jobs from 256 to 512
* Increase max write/garbage daemons from 10 to 20
* Add history recall functionality to direct and debug modes [127 line buffer]
* Add `-k` option to `rsm` executable, to stop an environment from the shell
* Add message when shutting down an environment
* Increase size of lock table from 1 KiB to 8 KiB per job
* Add support for discovered run-time name and subscript indirection
* Add environment limits for global [128 GiB] and routine [~ 4 GiB] buffers
* Add `STRING_MAX` node to the `^$SYSTEM` system variable
* Add current UCI to the direct mode prompt
* Add current UCI to the M Command Language [MCL] prompt
* Handle environment start with additional buffers flag with an error for now
* Increase max decimal number from 63 to 256 digits
* Increase default decimal precision from 12 to 18 digits
* Increase max decimal precision from 31 to 64 digits
* Improve error handling for max numbers
* Increase max I/O channels from 16 to 32
* Change the forking TCP server to allow immediate port reconnection [TIME_WAIT]
* Prevent erroneous extra characters after intrinsic variable or function names
* Fix multi-level argument indirection to properly return an error
* Fix setting of volume name in `^$SYSTEM` to allow for full 32 characters
* Fix `^$SYSTEM` bug that leads to a segfault
* Fix display bug when retrieving historic features support values in `^$SYSTEM`
* Fix bug when setting historic features support values in `^$SYSTEM`
* Fix bug that prevents the debugger from hitting a breakpoint more than once
* Fix `$TEXT` bug that returns the name of routines that did not exist
* Fix bug that displays non-existent locks with the `$&DEBUG("LTD")` XCall
* Fix and improve the display of the `$&DEBUG` XCall
* Change the arguments to the `$&DEBUG` XCall to be case-insensitive
* Expose the `STRUCT` argument to the `$&DEBUG` XCall on all platforms
* Coalesce all daemon_*.log files in to one daemon.log file
* Improve log message format, adding more detailed information
* Fix symbol table bug preventing symbol table full error [`Z56`]
* Fix DBC overflow integrity test [`$&%IC` XCall] bug
* Fix stack smashing bug in math module
* Improve accuracy of fractional powers in math module
* Add and improve error messages in math module
* Improve error messages in error utility module
* Add more error handling in symbol table module
* Change use of name lengths longer than the max in routines to an `M56` error
* Add extra string length bounds checking for database records
* Add more information to error messages displayed during startup
* Add extra error handling to the compiler and the run-time
* Increase the max string length for `SET $PIECE`/`SET $EXTRACT` by 1 character
* Add better max string error handling to the `SET $PIECE` functionality
* Increase max routine tags/labels from 255 to 256
* Update the help menu with the new limits and functionality
* Add more source constants for internal language and database size limits
* Add new error code [`Z74`] to indicate too many variables in a routine
* Add new error code [`Z75`] to indicate too many arguments in the formal list
* Make various format, grammar, and spelling improvements in the source code
* Add terminal size support for the output of the info key-binding [`Ctrl-T`]
* Fix double free bugs in the interpreter
* Increase size of the runtime stack structures
* Add constant information to error messages
* Modify the `^UCI` utility routine to allow changing the manager UCI name
* Fix display issues in the global efficiency utility routine [`^%GE`]
* Improve variable scoping in vendor utility routines
* Modify vendor utility routines to use `^$SYSTEM("STRING_MAX")`
* Improve support for long output to vendor utility routine [`^%U`]
* Fix bug in the way tags/labels are defined in the `^MATH` utility routines
* Fix bug preventing the `^%ZUCI` routine from handling user error inputs
* Improve formatting of vendor utility routines
* Improve the upgrade script
* Fix bug on Cygwin that prevents a privileged job from shutting RSM down
* Fix various minor bugs
* Improve data typing throughout
* Improve parts of the documentation
* Rename release-notes.adoc to CHANGELOG.adoc

=== v1.73.1 -- 2021 Mar 4

* Add fix to support ISC Cache routine export format, supplied by Sam Habiel

This version erroneously displays V1.73.0 instead of V1.73.1 when using `WRITE
$SYSTEM` and `rsm -h`.

=== v1.73.0 -- 2020 Dec 26

* Increase max length of names from 8 characters to 32 characters
  - Global variable names
  - Local variable names
  - Routine names
  - Routine tag/label names
  - UCI names
  - Volume names
* Add `NAME_LENGTH` node to the `^$SYSTEM` system variable for version support
* Change use of name lengths longer than the max at run-time to an `M56` error
* Update database to version 2
* Update compiler to version 8
* Add `install` rule to build files to install `rsm` in a system location
* Add `dbver=1` option to build `rsm` using database version 1 for upgrades
* Add upgrade script to convert a database from version 1 to version 2
* Create magic configuration for database and journal file formats
* Add continuous integration configuration script [`.gitlab-ci.yml`]
* Fix various compiler warnings on supported platforms
* Fix various linter warnings and suggestions
* Add support for the `RSM_DBFILE` environment variable [database file path]
* Add `-e` option when creating a database to set the name of the manager UCI
* Add `-h` option to `rsm` executable, to display the help usage menu
* Improve the `rsm` help usage menu
* Improve and update documentation
* Allow setting a large map block to address the max database size [262147 KiB]
* Add `creation_time` to label block set to datetime stamp of database creation
* Change database and journal datetime stamps to consistently use local offsets
* Handle attaching a new database file to an old memory environment gracefully
* Improve error handling in several places
* Improve the daemon log messages
* Fix `^$SYSTEM` UCI bugs that lead to segfaults
* Fix journal header datetime stamp size
* Fix journal bug that prevents journaling the first `SET`/`KILL` of a global
* Fix error handling bug that broke the handling of the null character in a key
* Fix `JOB` bug when passing one or more arguments with a timeout
* Fix `$DATA` bug with the `^$GLOBAL` system variable top node
* Fix device timeout bug
* Fix integrity checker [`$&%IC` XCall] to work with global directory blocks
* Improve the fix for the `WRITE` form feed command [`WRITE #`]
* Change `$STORAGE` to return remaining symbol table slots, rather than 1024
* Add use of ASCII 127 as an input terminator
* Fix I/O to support shell heredocs and other I/O redirection
* Remove hard-coded support for the '`ONE`' application
* Fix I/O daemonizing bug when starting up write/garbage daemons
* Change the `$BP` [breakpoints] intrinsic variable to `$ZBP` and expose it in M
* Fix output bug cutting off last character in `$SYSTEM`
* Add pipe mode to the `$&%SPAWN` XCall, to redirect shell output to a variable
* Fix all compiler errors in the vendor utility routines
* Update vendor routines to work with version 1 and 2 databases and journals
* Update vendor utility routines to optionally display full global data
* Fix bug in the M Command Language OS shelling functionality
* Fix bug in `^UCI` utility routine that allows editing of UCI 1 [manager]
* Fix bug that prevents the `Dump` functionality in the database `^FIX` utility
* Fix search bug in the `List` functionality in the database `^FIX` utility
* Fix display bug with empty formal lists in the routine `^DECOMP` utility
* Improve error handling of routine restore/save, so that they continue on error
* Split the `^MATH` utility routine in order to support smaller database blocks
* Update formatting of utilities that display data throughout
* Add support for journals made from database versions 1 and 2 to `^JOURNLST`
* Add current journal file set as default in the journal `^JOURNLST` utility
* Add big-endian machine support when using `VIEW`/`$VIEW` in vendor routines
* Add support to the vendor routines for manager UCIs not named '`MGR`'
* Modify vendor utility routines to use `^$SYSTEM("NAME_LENGTH")`
* Add support for long output to vendor utility routine [`^%U`]
* Add `Shutdown` command to the MCL to shut down an environment
* Add UCI name to the `List` functionality in the database `^FIX` utility
* Add max jobs option to the vendor-supplied M web server [`^%WWW` `^%WWW1`]
* Add `KVALUE` M polyfill to the `^MATH` utility dispatch routine

=== v1.72.0 -- 2020 Nov 2

The first release of Reference Standard M is based on MUMPS V1 by Raymond
Douglas Newman, located at https://gitlab.com/Reference-Standard-M/mumpsv1.

The initial release notes refer to changes between MUMPS V1.71 and Reference
Standard M V1.72.0.

* Change repository to refer to new name, maintainer, copyright, and license
* Update build rules to maintain support on the platforms we are targeting
* Fix various compiler warnings on supported platforms
* Fix various linter errors and warnings
* Change version scheme to semantic versioning
* Remove shared memory when there is an environment initialization error
* Reset terminal to initial settings when shutting down the environment
* Improve error and exception handling
* Fix several bugs that lead to segfaults
* Fix several memory and resource leaks
* Fix several minor bugs
* Fix commenting errors
* Remove unused, extraneous code
* Remove alternate terminal code for input terminators
* Remove use of ASCII 127 as an input terminator
* Fix the `WRITE` form feed command [`WRITE #`]
* Improve the `$&%DIRECTORY` XCall semantics
* Update, and improve, the `$&PASCHK` XCall to work on more supported platforms
* Add entryref for port # to the vendor-supplied M web server [`^%WWW` `^%WWW1`]

[role="right"]
link:doc/index.adoc[Index]
